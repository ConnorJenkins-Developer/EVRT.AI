<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>EVRT — Projects & Case Studies</title>
  <meta name="description" content="Outcomes we engineered: Social AI, Ad Studio, Ad Lab, Dashboards, and Security guardrails—documented with measurable lift and artifacts."/>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300..900&family=Space+Grotesk:wght@400;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="assets/style.css"/>

  <style>
    :root{
      --pr-neon:#6ee7ff; --pr-accent:#63ffa5; --pr-amber:#ffd75a; --pr-danger:#ff4d6d;
      --pr-bg:#0a0e14; --pr-card:#0f141c; --pr-grid:rgba(255,255,255,.06); --pr-mute:#8fa2b7;
    }
    body{ background: radial-gradient(1400px 900px at 80% -260px,#142034 0,#0a0e14 65%); }

    /* Backdrop */
    .layers{ position:fixed; inset:0; z-index:0; pointer-events:none; }
    #halo{ position:absolute; inset:0; opacity:.25 }
    .scan{ position:absolute; inset:0; background:linear-gradient(to bottom, rgba(255,255,255,.03) 1px, transparent 1px) 0 0/100% 3px; opacity:.26; mix-blend-mode:overlay }

    /* Layout + UI */
    .section{ position:relative; z-index:1 }
    .eyebrow{ letter-spacing:.12em; text-transform:uppercase; color:var(--pr-mute) }
    .muted{ color:var(--pr-mute) }
    .control{ border:1px solid var(--pr-grid); border-radius:12px; background:#0f141c; padding:10px 12px; color:inherit }
    .chips{ display:flex; flex-wrap:wrap; gap:8px }
    .chip{ padding:6px 10px; border-radius:999px; border:1px solid var(--pr-grid); cursor:pointer; user-select:none }
    .chip.active{ background:linear-gradient(90deg,var(--pr-neon),var(--pr-accent)); color:#061019; border:0; font-weight:800 }
    .btn.neon{ background:linear-gradient(90deg,var(--pr-neon),var(--pr-accent)); color:#061019; border:0; font-weight:800 }
    .btn.ghost{ border:1px solid var(--pr-grid) }

    /* Cards / Grid */
    .grid{ display:grid; gap:14px; grid-template-columns:1fr; }
    @media(min-width:950px){ .grid{ grid-template-columns:repeat(2,1fr); } }
    @media(min-width:1300px){ .grid{ grid-template-columns:repeat(3,1fr); } }
    .card{ position:relative; border:1px solid var(--pr-grid); border-radius:16px; background:linear-gradient(180deg,rgba(255,255,255,.06),rgba(255,255,255,.02)); padding:14px; overflow:hidden; transform-style:preserve-3d; transition:transform .15s ease, box-shadow .2s ease, border-color .2s; }
    .card:hover{ border-color:rgba(110,231,255,.45); box-shadow:0 14px 50px rgba(110,231,255,.10), 0 0 0 1px rgba(110,231,255,.25) inset; }
    .orb{ position:absolute; inset:auto auto -10% -10%; width:140px; height:140px; background:radial-gradient(closest-side, rgba(110,231,255,.28), transparent 70%); filter:blur(12px); pointer-events:none }
    .badge{ display:inline-flex; align-items:center; gap:6px; padding:4px 10px; border:1px solid var(--pr-grid); border-radius:999px; font-size:12px }
    .row{ display:flex; justify-content:space-between; align-items:center; gap:10px }
    .row.wrap{ flex-wrap:wrap }
    .tag{ font-size:11px; padding:2px 8px; border:1px solid var(--pr-grid); border-radius:999px; color:var(--pr-mute) }
    .tags{ display:flex; gap:6px; flex-wrap:wrap }

    /* Trust strip */
    .trust{ display:flex; gap:12px; flex-wrap:wrap }
    .trust .t{ padding:8px 10px; border:1px solid var(--pr-grid); border-radius:10px; color:#9fb3c8; background:#0f141c }

    /* Drawer */
    .drawer{ position:fixed; left:50%; transform:translateX(-50%); bottom:18px; width:min(1080px,92vw); z-index:50; display:none }
    .drawer .box{ background:#07121b; border:1px solid rgba(110,231,255,.35); border-radius:14px; padding:12px }
    .drawer .mini{ color:#9fb3c8; font-size:12px }
    .artifact{ border:1px solid var(--pr-grid); border-radius:12px; background:#0f141c; padding:10px; }

    /* Charts */
    canvas.chart{ width:100%; height:220px; border:1px solid var(--pr-grid); border-radius:12px; background:#0f141c; }

    /* Impact Gallery / Timeline */
    .gallery{ border:1px solid var(--pr-grid); border-radius:14px; padding:12px; background:#0f141c }
    .timeline{ display:flex; gap:10px; overflow:auto; padding-bottom:6px }
    .milestone{ min-width:240px; border:1px solid var(--pr-grid); border-radius:12px; background:linear-gradient(180deg,rgba(255,255,255,.05),rgba(255,255,255,.015)); padding:10px }

    /* Evidence mode toggle */
    .switch{ display:inline-flex; align-items:center; gap:6px; cursor:pointer; user-select:none }
    .switch input{ appearance:none; width:36px; height:20px; border-radius:999px; background:#0b0e13; border:1px solid var(--pr-grid); position:relative; outline:0 }
    .switch input:checked{ background:linear-gradient(90deg,var(--pr-neon),var(--pr-accent)); border:0 }
    .switch input::after{ content:''; position:absolute; top:3px; left:3px; width:14px; height:14px; border-radius:999px; background:#9fb3c8; transition:left .2s }
    .switch input:checked::after{ left:19px; background:#061019 }

    /* Palette */
    .palette{ position:fixed; inset:0; display:none; place-items:center; z-index:80; backdrop-filter:blur(6px); background:rgba(5,8,13,.55) }
    .palette .box{ width:min(800px,92vw); background:#0f141c; border:1px solid var(--pr-grid); border-radius:12px; overflow:hidden }
    .palette input{ width:100%; padding:12px; border:0; outline:0; background:#0b0e13; color:inherit; font-size:16px }
    .palette .rows{ max-height:300px; overflow:auto }
    .palette .rows .row{ padding:10px 12px; border-top:1px solid rgba(255,255,255,.06); display:flex; justify-content:space-between; gap:8px; cursor:pointer }
    .palette .rows .row:hover{ background:rgba(110,231,255,.08) }

    /* Sticky CTA */
    .sticky-cta{ position:sticky; bottom:12px; z-index:40; display:flex; justify-content:center }
    .sticky-cta .bar{ width:min(1080px,92vw); backdrop-filter:blur(8px); background:#07121b; border:1px solid rgba(110,231,255,.35); border-radius:14px; padding:10px; display:flex; gap:10px; align-items:center }
    .ping{ width:8px; height:8px; border-radius:50%; background:#63ffa5; box-shadow:0 0 0 6px rgba(99,255,165,.15) }
  </style>
</head>
<body>
  <!-- Backdrop -->
  <div class="layers">
    <canvas id="halo" aria-hidden="true"></canvas>
    <div class="scan" aria-hidden="true"></div>
  </div>

  <div data-include="partials/header.html"></div>

  <!-- HERO -->
  <section class="container hero section" style="margin-top:20px">
    <span class="eyebrow">EVRT Projects</span>
    <h1 class="gradient-text">Case Studies.<br/>Measurable. Visual. Verifiable.</h1>
    <p class="sub">We ship outcomes. Filter by service or sector, open any case, and inspect **artifacts** in <strong>Evidence Mode</strong>. Press <strong>⌘/Ctrl-K</strong> to jump.</p>
    <div class="trust" style="margin-top:10px">
      <div class="t">Trusted for ROAS turnarounds</div>
      <div class="t">Security hardening in regulated niches</div>
      <div class="t">Playbooks shipped in 3 weeks</div>
      <div class="t">Data-first. No fluff.</div>
    </div>

    <div class="row wrap" style="margin-top:10px">
      <input id="q" class="control" placeholder="Search projects, clients, metrics…"/>
      <div id="svc" class="chips">
        <!-- services chips -->
      </div>
      <div id="sec" class="chips">
        <!-- sectors chips -->
      </div>
      <div class="switch" title="Evidence Mode">
        <input id="evidence" type="checkbox"/>
        <span class="muted">Evidence Mode</span>
      </div>
      <select id="sort" class="control">
        <option value="impact">Sort: Impact</option>
        <option value="new">Sort: Newest</option>
        <option value="alpha">Sort: A–Z</option>
      </select>
    </div>
  </section>

  <!-- IMPACT GALLERY -->
  <section class="container section">
    <div class="gallery">
      <div class="row">
        <h3 style="margin:0">Impact Gallery</h3>
        <div class="muted">Live bar chart of top lifts across projects.</div>
      </div>
      <canvas id="gallery" class="chart" width="1000" height="220" style="margin-top:8px"></canvas>
    </div>
  </section>

  <!-- GRID -->
  <section class="container section">
    <div id="grid" class="grid"></div>
  </section>

  <!-- TIMELINE REEL -->
  <section class="container section">
    <div class="row">
      <h3 style="margin:0">Timeline Reel</h3>
      <div class="muted">Blueprint → Live → Learn → Prove</div>
    </div>
    <div id="timeline" class="timeline" style="margin-top:8px"></div>
  </section>

  <!-- CASE DRAWER -->
  <div id="drawer" class="drawer">
    <div class="box">
      <div class="row wrap">
        <strong id="dTitle">Case</strong>
        <div class="muted" id="dMeta" style="margin-left:auto">—</div>
      </div>
      <div class="row wrap" style="margin-top:8px">
        <div class="badge" id="dBadges">—</div>
        <div style="margin-left:auto;display:flex;gap:8px">
          <button id="btnOpenApp" class="btn">Open related app</button>
          <button id="btnCopy" class="btn">Copy link</button>
          <button id="btnBrief" class="btn ghost">Download brief (.md)</button>
          <button id="btnClose" class="btn">Close</button>
        </div>
      </div>

      <div class="grid" style="grid-template-columns:1.2fr 1fr; gap:12px; margin-top:10px">
        <div class="artifact">
          <h4 style="margin:0 0 6px">Before/After Metrics</h4>
          <canvas id="dChart" class="chart" width="700" height="220"></canvas>
          <p class="mini" id="dChartNote" style="margin-top:6px">Simulated telemetry for visual proof.</p>
        </div>
        <div class="artifact">
          <h4 style="margin:0 0 6px">Summary</h4>
          <p id="dSummary" class="muted"></p>
          <div id="dTags" class="tags" style="margin-top:6px"></div>
        </div>
      </div>

      <div id="dEvidence" class="grid" style="grid-template-columns:1fr 1fr; gap:12px; margin-top:12px; display:none">
        <div class="artifact">
          <h4 style="margin:0 0 6px">Creative Preview</h4>
          <div id="dAd" style="border:1px dashed rgba(255,255,255,.2); border-radius:12px; padding:10px; display:grid; grid-template-columns:74px 1fr; gap:10px; align-items:center">
            <div style="width:74px;height:74px;border-radius:10px;background:linear-gradient(180deg,#6ee7ff33,#63ffa533)"></div>
            <div>
              <div style="font-weight:700" id="dAdH">—</div>
              <div class="muted" id="dAdB">—</div>
              <div class="tags" style="margin-top:6px"><span class="tag">Simulated</span><span class="tag">Preview</span></div>
            </div>
          </div>
        </div>
        <div class="artifact">
          <h4 style="margin:0 0 6px">Experiment Log</h4>
          <pre id="dLog" style="white-space:pre-wrap;color:#9fb3c8; font-family:ui-monospace,Menlo,Consolas,monospace; background:#05080d; border-radius:10px; padding:10px; border:1px solid rgba(110,231,255,.25)"></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- COMMAND PALETTE -->
  <div id="palette" class="palette" aria-modal="true" role="dialog">
    <div class="box">
      <input id="palInput" placeholder="Jump to a project…"/>
      <div id="palRows" class="rows"></div>
    </div>
  </div>

  <!-- Sticky CTA -->
  <div class="sticky-cta">
    <div class="bar">
      <span class="badge"><span class="ping"></span> Proof-driven delivery</span>
      <div class="muted" style="flex:1">Ready to build your case study? We’ll ship a 3-week sprint and measure lift.</div>
      <a class="btn neon" href="consulting.html">Book consult</a>
    </div>
  </div>

  <div data-include="partials/footer.html"></div>

  <script defer src="assets/app.js"></script>
  <script>
    /* ===== Backdrop halo ===== */
    (function haloFX(){
      const c=document.getElementById('halo'), ctx=c.getContext('2d');
      function resize(){ c.width=innerWidth; c.height=innerHeight; }
      resize(); addEventListener('resize', resize);
      const orbs = Array.from({length:7}, ()=>({x:Math.random()*c.width, y:Math.random()*c.height*0.6, r: 90+Math.random()*160, dx:(Math.random()-.5)*0.5, dy:(Math.random()-.5)*0.5, hue: 180+Math.random()*90}));
      (function tick(){
        ctx.clearRect(0,0,c.width,c.height);
        orbs.forEach(o=>{
          o.x+=o.dx; o.y+=o.dy; if(o.x<-100||o.x>c.width+100) o.dx*=-1; if(o.y<-100||o.y>c.height*0.8) o.dy*=-1;
          const g=ctx.createRadialGradient(o.x,o.y, 0, o.x,o.y, o.r);
          g.addColorStop(0, `hsla(${o.hue}, 100%, 60%, .12)`); g.addColorStop(1, 'transparent');
          ctx.fillStyle=g; ctx.beginPath(); ctx.arc(o.x,o.y,o.r,0,6.283); ctx.fill();
        });
        requestAnimationFrame(tick);
      })();
    })();

    /* ===== Data ===== */
    const SERVICES = [
      {id:'social', name:'Social AI'},
      {id:'adstudio', name:'Ad Studio'},
      {id:'adlab', name:'Ad Lab'},
      {id:'dash', name:'Dashboard'},
      {id:'cyber', name:'Security'},
      {id:'apps', name:'Apps/Web'}
    ];
    const SECTORS = ['eCommerce','SaaS','Healthcare','Finance','Education','Hospitality','Manufacturing'];

    const PROJECTS = [
      { id:'p-social-fashion', client:'Aster Apparel', sector:'eCommerce', services:['Social AI','Dashboard'], period:'Q2 → Q3', impact:3.1, ctr:+18, cpa:-22, roas:+2.4, ttc:4.0, summary:'Launched precision scheduler across Meta + TikTok; best-minute predictions lifted CTR and lowered CPA while dashboard telemetry proved winners.', tags:['Scheduler','Predictive','Cohorts'], ad:{h:'New drop. Zero fluff. 48h only.', b:'Predictive picks your posting minute so your fans actually see it.'}, log:['init telemetry','drafted 12 hooks','ε-greedy bandit on 3 creatives','lock winner; scale 30%','alert: anomaly spike resolved'] , link:'social-ai.html' },
      { id:'p-studio-d2c', client:'Beam Nutrition', sector:'eCommerce', services:['Ad Studio','Dashboard'], period:'Q1', impact:2.7, ctr:+14, cpa:-18, roas:+2.1, ttc:3.2, summary:'Audience → creative → plan loop. Predicted ROAS mix; launched with safety rails.', tags:['Lookalikes','Creative Mix','Anomalies'], ad:{h:'Spend less. Learn faster.', b:'Ad Studio simulates mixes before you burn budget.'}, log:['seed audiences','simulate 9 mixes','pick top-2 by edge','ship live','anomaly: UTM mismatch fixed'], link:'ad-studio.html' },
      { id:'p-lab-b2b', client:'Vector Cloud', sector:'SaaS', services:['Ad Lab','Ad Studio'], period:'Q2', impact:2.9, ctr:+12, cpa:-26, roas:+2.0, ttc:3.6, summary:'Alien-grade sandbox. Bandit Arena found angle → “migrate in 48h” outperformed baseline.', tags:['Bandits','Copy','Landing'], ad:{h:'Migrate in 48h. No drama.', b:'Bandit Arena hunts winner while you sleep.'}, log:['spin 5 angles','epsilon=0.2','winner in 5 days','shift 70% budget','C-suite dashboard brief'], link:'adlab.html' },
      { id:'p-dash-health', client:'Cura Clinics', sector:'Healthcare', services:['Dashboard','Security'], period:'Q3', impact:2.4, ctr:+9, cpa:-16, roas:+1.7, ttc:2.8, summary:'PII-safe telemetry + funnel views. Reduced blind spots; steady CPA improvement.', tags:['PII Safe','Funnels','Alerts'], ad:{h:'Ship dashboards without risk.', b:'Guardrails keep trust while you move.'}, log:['mask PHI','roles enforced','alerts tuned','weekly cohort readout'], link:'dashboard.html' },
      { id:'p-cyber-fin', client:'Mint Ledger', sector:'Finance', services:['Security','Dashboard'], period:'Q4', impact:2.2, ctr:+7, cpa:-12, roas:+1.5, ttc:2.2, summary:'Hardened stack + anomaly triage. Zero critical incidents during launch.', tags:['Guardrails','Anomalies','Compliance'], ad:{h:'Move fast. Don’t break trust.', b:'Security rails baked into growth.'}, log:['threat model','WAF rules','SIEM hooks','0 criticals'], link:'cybersecurity.html' },
      { id:'p-apps-edu', client:'LearnNow', sector:'Education', services:['Apps/Web','Social AI'], period:'Q1 → Q2', impact:2.5, ctr:+11, cpa:-15, roas:+1.9, ttc:3.1, summary:'Shipped micro-apps + content pipeline; improved activation and retention.', tags:['Activation','Content','Micro-apps'], ad:{h:'Enrollments up. Ops calm.', b:'Micro-apps + schedule = compounding wins.'}, log:['scope micro-apps','ship weekly','measure activation','double down on winners'], link:'apps.html' },
    ];

    /* ===== State ===== */
    const state = {
      q:'', svc:'all', sec:'all', evidence:false, sort:'impact'
    };

    /* ===== Helpers ===== */
    const el = s=>document.querySelector(s), els = s=>Array.from(document.querySelectorAll(s));
    function kebab(s){ return s.toLowerCase().replace(/[^a-z0-9]+/g,'-'); }

    /* ===== Build filters ===== */
    function buildChips(){
      const svc = el('#svc'); svc.innerHTML='';
      const any = document.createElement('span'); any.className='chip active'; any.dataset.id='all'; any.textContent='All Services'; any.onclick=()=>{ state.svc='all'; updateAll(); }; svc.appendChild(any);
      SERVICES.forEach(s=>{
        const c = document.createElement('span'); c.className='chip'; c.dataset.id=s.name; c.textContent=s.name; c.onclick=()=>{ state.svc=s.name; updateAll(); }; svc.appendChild(c);
      });

      const sec = el('#sec'); sec.innerHTML='';
      const any2 = document.createElement('span'); any2.className='chip active'; any2.dataset.id='all'; any2.textContent='All Sectors'; any2.onclick=()=>{ state.sec='all'; updateAll(); }; sec.appendChild(any2);
      SECTORS.forEach(s=>{
        const c = document.createElement('span'); c.className='chip'; c.dataset.id=s; c.textContent=s; c.onclick=()=>{ state.sec=s; updateAll(); }; sec.appendChild(c);
      });
    }

    /* ===== Grid ===== */
    function match(p){
      const inSvc = state.svc==='all' || p.services.includes(state.svc);
      const inSec = state.sec==='all' || p.sector===state.sec;
      const q = state.q.trim().toLowerCase();
      const inQ = !q || [p.client,p.summary, ...p.tags, ...p.services].join(' ').toLowerCase().includes(q);
      return inSvc && inSec && inQ;
    }
    function sortList(list){
      if(state.sort==='alpha') return list.sort((a,b)=> a.client.localeCompare(b.client));
      if(state.sort==='new')   return list; // already seeded newest-first feel; could add dates
      return list.sort((a,b)=> b.impact - a.impact);
    }
    function cardHTML(p){
      return `
        <div class="card" data-id="${p.id}">
          <div class="orb"></div>
          <div class="row">
            <div class="badge">${p.sector}</div>
            <div class="row" style="gap:8px">
              <span class="badge" title="Impact multiplier">${p.impact.toFixed(1)}×</span>
              <span class="badge" title="ROAS lift">ROAS ${p.roas>0?'+':''}${p.roas.toFixed(1)}×</span>
            </div>
          </div>
          <h3 style="margin:8px 0 2px">${p.client}</h3>
          <div class="muted">${p.summary}</div>
          <div class="tags" style="margin-top:8px">${p.services.map(s=>`<span class="tag">${s}</span>`).join('')} ${p.tags.map(t=>`<span class="tag">${t}</span>`).join('')}</div>
          <div class="row wrap" style="margin-top:10px">
            <button class="btn neon" data-open="${p.id}">View Case</button>
            <a class="btn" href="${p.link}">Open Related</a>
            <button class="btn" data-copy="${p.id}">Copy Link</button>
          </div>
        </div>
      `;
    }
    function renderGrid(){
      const grid = el('#grid'); grid.innerHTML='';
      const list = sortList(PROJECTS.filter(match));
      if(!list.length){ grid.innerHTML='<div class="muted">No matches. Try changing filters.</div>'; return; }
      list.forEach(p=>{
        const w=document.createElement('div'); w.innerHTML=cardHTML(p); const card=w.firstElementChild; grid.appendChild(card);
      });
      // tilt + handlers
      els('.card').forEach(card=>{
        card.addEventListener('mousemove', (e)=>{ const r=card.getBoundingClientRect(); const x=(e.clientX-r.left)/r.width, y=(e.clientY-r.top)/r.height; card.style.transform=`rotateX(${(y-.5)*8}deg) rotateY(${(x-.5)*-8}deg)`; });
        card.addEventListener('mouseleave', ()=> card.style.transform='' );
      });
      els('[data-open]').forEach(b=> b.onclick=()=> openCase(b.dataset.open));
      els('[data-copy]').forEach(b=> b.onclick=()=> copyPermalink(b.dataset.copy));
    }

    /* ===== Timeline Reel ===== */
    function renderTimeline(){
      const box = el('#timeline'); box.innerHTML='';
      PROJECTS.forEach(p=>{
        const m=document.createElement('div'); m.className='milestone';
        m.innerHTML = `<div class="badge">${p.sector}</div><strong style="display:block;margin:6px 0">${p.client}</strong>
                       <div class="muted">${p.period}</div>
                       <div class="tags" style="margin-top:6px">${p.services.map(s=>`<span class="tag">${s}</span>`).join('')}</div>
                       <div class="row wrap" style="margin-top:8px"><button class="btn" data-open="${p.id}">View</button><span class="badge">${p.impact.toFixed(1)}×</span></div>`;
        box.appendChild(m);
      });
      box.querySelectorAll('[data-open]').forEach(b=> b.onclick=()=> openCase(b.dataset.open));
    }

    /* ===== Gallery chart ===== */
    const gal = el('#gallery'), gctx = gal.getContext('2d');
    function drawGallery(){
      const W=gal.width=gal.clientWidth, H=gal.height=gal.clientHeight;
      gctx.clearRect(0,0,W,H); gctx.fillStyle='#0f141c'; gctx.fillRect(0,0,W,H);
      gctx.strokeStyle='rgba(255,255,255,.08)'; for(let i=0;i<4;i++){ gctx.beginPath(); gctx.moveTo(40, 20+i*(H-60)/3); gctx.lineTo(W-20, 20+i*(H-60)/3); gctx.stroke(); }
      const top = [...PROJECTS].sort((a,b)=> (b.roas) - (a.roas)).slice(0,6);
      const bw = (H-60)/top.length; const max = Math.max(...top.map(x=> x.roas));
      top.forEach((p,i)=>{
        const val = p.roas; const w = (W-180) * (val / (max||1));
        const y = 30 + i*bw;
        const color = ['#6ee7ff','#63ffa5','#ffd75a','#ff4d6d','#8ab6ff','#caffbf'][i%6];
        gctx.fillStyle=color; gctx.shadowBlur=10; gctx.shadowColor=color+'66';
        gctx.fillRect(140, y, w, bw-14); gctx.shadowBlur=0;
        gctx.fillStyle='#9fb3c8'; gctx.font='12px Inter,system-ui';
        gctx.fillText(p.client, 20, y + (bw-14)/2 + 4);
        gctx.fillText((val>0?'+':'')+val.toFixed(1)+'×', 140 + w + 8, y + (bw-14)/2 + 4);
      });
    }
    setInterval(()=>{ // micro-jitter for “alive” feel
      PROJECTS.forEach(p=>{ p.roas = Math.max(1.3, Math.min(3.2, p.roas + (Math.random()-.5)*0.04)); });
      drawGallery();
    }, 1400);

    /* ===== Case Drawer ===== */
    let current=null;
    const drawer = el('#drawer');
    function openCase(id){
      const p = PROJECTS.find(x=>x.id===id); if(!p) return;
      current=p;
      el('#dTitle').textContent = p.client + ' — ' + p.services.join(' • ');
      el('#dMeta').textContent = `${p.sector} • ${p.period}`;
      el('#dBadges').innerHTML = `<span class="badge">Impact ${p.impact.toFixed(1)}×</span> <span class="badge">ROAS ${(p.roas>0?'+':'')+p.roas.toFixed(1)}×</span> <span class="badge">CPA ${p.cpa}%</span> <span class="badge">TTC ${p.ttc.toFixed(1)}× faster</span>`;
      el('#dSummary').textContent = p.summary;
      el('#dTags').innerHTML = p.tags.map(t=> `<span class="tag">${t}</span>`).join('');
      el('#dAdH').textContent = p.ad.h; el('#dAdB').textContent = p.ad.b;
      el('#dLog').textContent = (p.log||[]).map((l,i)=> `[${
        new Date(Date.now()-(p.log.length-i)*864e5).toISOString().slice(0,10)
      }] ${l}`).join('\n');
      drawCaseChart(p);
      el('#dEvidence').style.display = state.evidence ? '' : 'none';
      drawer.style.display='block';
      history.replaceState(null,'', location.pathname + '?id=' + encodeURIComponent(p.id));
    }
    function closeCase(){
      drawer.style.display='none'; current=null;
      const u = new URL(location.href); u.searchParams.delete('id'); history.replaceState(null,'', u.pathname);
    }
    el('#btnClose').onclick = closeCase;
    el('#btnCopy').onclick = ()=> copyPermalink(current?.id);
    el('#btnBrief').onclick = ()=> downloadBrief(current);
    el('#btnOpenApp').onclick = ()=>{ if(current?.link) location.href = current.link; };

    /* ===== Case chart ===== */
    const dChart = el('#dChart'), dctx = dChart.getContext('2d');
    function drawCaseChart(p){
      const W=dChart.width=dChart.clientWidth, H=dChart.height=dChart.clientHeight;
      dctx.clearRect(0,0,W,H); dctx.fillStyle='#0f141c'; dctx.fillRect(0,0,W,H);
      // axes
      dctx.strokeStyle='rgba(255,255,255,.08)'; for(let i=0;i<5;i++){ dctx.beginPath(); dctx.moveTo(40, 20+i*(H-60)/4); dctx.lineTo(W-20, 20+i*(H-60)/4); dctx.stroke(); }
      // build series (simulated before/after CTR & CPA)
      const N=24;
      const beforeCTR = Array.from({length:N}, (_,i)=> 0.9 + Math.sin(i*.3)*0.1 + (Math.random()-.5)*0.03 );
      const afterCTR  = Array.from({length:N}, (_,i)=> 1.0 + (p.ctr/100) + Math.sin(i*.28+0.6)*0.1 + (Math.random()-.5)*0.03 );
      const beforeCPA = Array.from({length:N}, (_,i)=> 1.00 - 0.00*i );
      const afterCPA  = Array.from({length:N}, (_,i)=> 1.00 + (p.cpa/100) + Math.sin(i*.25+1.2)*0.02 ); // p.cpa is negative (reduction)

      function line(series, color, yBase, scale){
        dctx.beginPath(); series.forEach((v,i)=>{
          const x = 50 + i*(W-100)/(N-1); const y = 40 + (1 - (v - yBase)*scale) * (H-80);
          i? dctx.lineTo(x,y) : dctx.moveTo(x,y);
        });
        dctx.strokeStyle=color; dctx.lineWidth=2; dctx.stroke();
      }
      line(beforeCTR, '#9fb3c8', 0.8, 0.9);
      line(afterCTR,  '#63ffa5', 0.8, 0.9);
      line(beforeCPA, '#9fb3c844', 0.8, 0.6);
      line(afterCPA,  '#ff4d6d', 0.8, 0.6);
      dctx.fillStyle='#9fb3c8'; dctx.font='12px Inter,system-ui';
      dctx.fillText('CTR (before/after) — CPA (before/after)', 50, 24);
    }

    /* ===== Evidence toggle ===== */
    el('#evidence').addEventListener('change', (e)=>{ state.evidence = e.target.checked; if(current){ el('#dEvidence').style.display = state.evidence ? '' : 'none'; } });

    /* ===== Search / Sort ===== */
    el('#q').addEventListener('input', e=>{ state.q = e.target.value; updateAll(); });
    el('#sort').addEventListener('change', e=>{ state.sort = e.target.value; updateAll(); });

    /* ===== Command Palette ===== */
    const palette=el('#palette'), palInput=el('#palInput'), palRows=el('#palRows');
    function openPalette(){ palette.style.display='grid'; palInput.value=''; buildRows(''); palInput.focus(); }
    function closePalette(){ palette.style.display='none'; }
    function buildRows(q){
      palRows.innerHTML='';
      PROJECTS.filter(p=> !q || (p.client+' '+p.summary+' '+p.sector+' '+p.services.join(' ')).toLowerCase().includes(q.toLowerCase()))
              .slice(0,20).forEach(p=>{
        const row=document.createElement('div'); row.className='row'; row.innerHTML=`<div>${p.client}<div class="muted">${p.sector} • ${p.services.join(' • ')}</div></div><button class="btn">Open</button>`;
        row.onclick=()=>{ closePalette(); openCase(p.id); };
        palRows.appendChild(row);
      });
    }
    addEventListener('keydown', (e)=>{
      if((e.metaKey||e.ctrlKey) && e.key.toLowerCase()==='k'){ e.preventDefault(); openPalette(); }
      if(e.key==='Escape'){ closePalette(); }
    });
    palInput.addEventListener('input', e=> buildRows(e.target.value));
    palette.addEventListener('click', (e)=>{ if(e.target===palette) closePalette(); });

    /* ===== Permalinks / Brief ===== */
    function copyPermalink(id){
      const url = location.origin + location.pathname + '?id=' + encodeURIComponent(id);
      navigator.clipboard.writeText(url);
      alert('Link copied: ' + url);
    }
    function downloadBrief(p){
      if(!p) return;
      const md = [
        `# Case Study — ${p.client}`,
        ``,
        `**Sector:** ${p.sector}  `,
        `**Services:** ${p.services.join(', ')}  `,
        `**Period:** ${p.period}`,
        ``,
        `## Summary`,
        `${p.summary}`,
        ``,
        `## Metrics`,
        `- Impact: ${p.impact.toFixed(1)}×`,
        `- ROAS: ${(p.roas>0?'+':'')+p.roas.toFixed(1)}×`,
        `- CPA: ${p.cpa}%`,
        `- Time to Creative: ${p.ttc.toFixed(1)}× faster`,
        ``,
        `## Tags`,
        p.tags.map(t=>`- ${t}`).join('\n'),
        ``,
        `## Notes`,
        (p.log||[]).map(l=>`- ${l}`).join('\n'),
        ``,
        `Related: ${location.origin + location.pathname.replace('projects.html', p.link)}`
      ].join('\n');
      const blob = new Blob([md], {type:'text/markdown'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a'); a.href = url; a.download = `${kebab(p.client)}-brief.md`; a.click();
      URL.revokeObjectURL(url);
    }

    /* ===== Update helpers ===== */
    function updateAll(){
      // chips state
      els('#svc .chip').forEach(ch=> ch.classList.toggle('active', ch.dataset.id === state.svc || (state.svc==='all' && ch.dataset.id==='all')));
      els('#sec .chip').forEach(ch=> ch.classList.toggle('active', ch.dataset.id === state.sec || (state.sec==='all' && ch.dataset.id==='all')));
      renderGrid(); drawGallery(); renderTimeline();
    }

    /* ===== Deep link boot ===== */
    function bootFromQuery(){
      const p = new URLSearchParams(location.search);
      if(p.get('id')) setTimeout(()=> openCase(p.get('id')), 0);
    }

    /* ===== Boot ===== */
    function boot(){
      buildChips();
      updateAll();
      addEventListener('resize', drawGallery);
      setTimeout(drawGallery, 0);
      bootFromQuery();
    }
    boot();
  </script>
</body>
</html>
